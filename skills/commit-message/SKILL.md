---
name: commit-message
description: 読みやすく効果的なコミットメッセージを作成するための包括的なガイド。Conventional Commits、Semantic Commits、日本語の慣習の3つの規約をサポート。git diff や git status からメッセージを生成、既存メッセージの検証、ベストプラクティスの提供、テンプレートの活用が可能。ユーザーが「コミットメッセージを作成」「コミットを作成」「git commit の手伝い」と依頼した時、またはコミットメッセージの品質向上やレビューが必要な時に使用。
---

# コミットメッセージ作成スキル

効果的で読みやすいコミットメッセージを作成するための包括的なガイドです。

## 概要

このスキルは、高品質なコミットメッセージの作成をサポートします：

- **自動生成**: git diff と git status からコミットメッセージを生成
- **規約サポート**: Conventional Commits、Semantic Commits、日本語の慣習
- **検証**: 既存メッセージが規約に従っているかチェック
- **ガイドライン**: ベストプラクティスとテンプレートの提供

## クイックスタート

### コミットメッセージの生成

ユーザーが「コミットメッセージを作成して」「コミットを作成」と依頼した場合：

1. **git status と git diff を確認**:
   ```bash
   git status
   git diff --staged
   ```

2. **変更内容を分析**:
   - どのファイルが変更されたか
   - 何が追加/修正/削除されたか
   - 変更の目的は何か

3. **適切な規約を選択**:
   - プロジェクトに `.commitlintrc` や既存のコミット履歴があれば、それに従う
   - 不明な場合は、ユーザーに希望する規約を確認
   - デフォルトは Conventional Commits

4. **メッセージを生成**:
   - 件名は50文字以内で簡潔に
   - 本文で「何を」「なぜ」を説明
   - 必要に応じて Issue 参照を含める

### 既存メッセージの検証

ユーザーが既存のコミットメッセージをチェックしたい場合：

1. メッセージを読み取る
2. 選択された規約に基づいて検証
3. 改善提案を提供

## 主要機能

### 1. メッセージ生成

git diff からコミットメッセージを自動生成します。

**手順:**

1. 変更内容を確認:
   ```bash
   git status
   git diff --staged
   git log --oneline -10  # 最近のコミットスタイルを確認
   ```

2. 変更を分析:
   - 新機能の追加か、バグ修正か、リファクタリングか
   - 変更の目的と背景
   - 影響範囲

3. 適切な type とメッセージを生成:
   - **Conventional Commits**: `feat:`, `fix:`, `docs:` など
   - **Semantic Commits**: `add:`, `update:`, `fix:` など
   - **日本語**: `追加:`, `修正:`, `更新:` など

**例:**

```
# 分析結果
- src/auth/login.ts に新しい関数追加
- 2段階認証のロジックを実装
- tests/auth.test.ts にテスト追加

# 生成されるメッセージ（Conventional Commits）
feat(auth): 2段階認証機能を追加

SMS経由の2段階認証を実装。
ログイン時にワンタイムコードを送信し、
ユーザーが入力することで認証を完了。

Closes #123
```

### 2. メッセージ検証

既存のコミットメッセージが規約に従っているか検証します。

**チェック項目:**

- [ ] 件名が50文字以内か
- [ ] 適切な type/動詞が使用されているか
- [ ] 件名の末尾にピリオドがないか
- [ ] 本文が必要な場合に記述されているか
- [ ] 本文の各行が72文字以内か
- [ ] Issue 参照が適切か

**検証プロセス:**

1. コミットメッセージを読み取る
2. 使用されている規約を推測
3. 各ルールに照らして検証
4. 問題点と改善案を提示

### 3. ガイドライン提供

効果的なコミットメッセージの書き方を教えます。

**よくある質問への回答:**

- 「良いコミットメッセージの書き方は？」
  → `references/best_practices.md` を参照してベストプラクティスを提供

- 「コミットの粒度はどうすべき？」
  → アトミックコミット（1つのコミット = 1つの論理的変更）を推奨

- 「本文には何を書くべき？」
  → 「何を」「なぜ」を中心に説明（「どのように」はコードから分かる）

### 4. テンプレート提供

様々な状況に応じたテンプレートを提供します。

**主なテンプレート:**

- 新機能追加（小規模・中規模・大規模）
- バグ修正（シンプル・詳細・緊急修正）
- リファクタリング
- パフォーマンス改善
- ドキュメント更新
- テスト追加
- 破壊的変更

詳細は `references/templates.md` を参照してください。

## サポートする規約

このスキルは3つの主要な規約をサポートします。

### Conventional Commits

国際的に広く使用される標準規約。

**基本フォーマット:**
```
<type>[optional scope]: <description>

[optional body]

[optional footer]
```

**主な type:**
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメント
- `style`: フォーマット
- `refactor`: リファクタリング
- `perf`: パフォーマンス改善
- `test`: テスト
- `chore`: その他

**詳細**: `references/conventional_commits.md` を参照

### Semantic Commits

より直感的な動詞を使用する規約。

**基本フォーマット:**
```
<verb>: <subject>

[optional body]
```

**主な動詞:**
- `add`: 新しい追加
- `update`: 既存の更新
- `fix`: バグ修正
- `remove`: 削除
- `refactor`: リファクタリング
- `improve`: 改善
- `document`: ドキュメント

**詳細**: `references/semantic_commits.md` を参照

### 日本語の慣習

日本語でのコミットメッセージ作成規約。

**基本フォーマット:**
```
<動詞>：<対象>

[詳細説明]
```

**主な動詞:**
- `追加`: 新機能・ファイル追加
- `修正`: バグ修正
- `更新`: 既存の改善
- `削除`: 削除・除去
- `リファクタリング`: コード整理
- `改善`: 品質・性能向上

**詳細**: `references/japanese_practices.md` を参照

## 使い方のワークフロー

### パターン1: コミット作成の依頼

```
ユーザー: 「コミットメッセージを作成して」

Claude:
1. git status と git diff --staged を実行
2. 変更内容を分析
3. プロジェクトの規約を確認（git log --oneline -10）
4. 適切なメッセージを生成
5. ユーザーに提示
```

### パターン2: メッセージ検証の依頼

```
ユーザー: 「このコミットメッセージをチェックして」

Claude:
1. メッセージを読み取る
2. 規約を判定（または確認）
3. 各ルールに照らして検証
4. 問題点と改善案を提示
```

### パターン3: ガイドラインの質問

```
ユーザー: 「良いコミットメッセージの書き方を教えて」

Claude:
1. references/best_practices.md を読み込む
2. 要点を整理して説明
3. 具体例を提供
```

### パターン4: 特定状況のテンプレート要求

```
ユーザー: 「バグ修正のコミットメッセージのテンプレートが欲しい」

Claude:
1. references/templates.md を読み込む
2. バグ修正セクションを抽出
3. 複数のテンプレートを提示
4. 状況に応じた選択を提案
```

## リファレンスファイル

このスキルには、以下の詳細なリファレンスが含まれています：

### `references/conventional_commits.md`

Conventional Commits 規約の詳細ガイド：
- 基本フォーマットと各要素の説明
- 全ての type の詳細
- Scope の使い方
- Description、Body、Footer の書き方
- 実例集（新機能、バグ修正、破壊的変更など）
- よくある間違いと改善例

**使用タイミング**: Conventional Commits について詳しく知りたい時、または Conventional Commits 形式でメッセージを作成する時

### `references/semantic_commits.md`

Semantic Commits 規約の詳細ガイド：
- より直感的な動詞ベースの規約
- 主要な動詞と補助的な動詞の一覧
- 動詞の使い分けガイド（add vs update、fix vs update など）
- Conventional Commits との比較
- 実例集

**使用タイミング**: Semantic Commits 形式を使用する時、または動詞の選択に迷った時

### `references/japanese_practices.md`

日本語コミットメッセージの慣習：
- 日本語でのメリットとデメリット
- 3つの基本フォーマット（動詞始まり、名詞句、ハイブリッド）
- 推奨される動詞一覧
- 件名と本文の書き方
- 文体の統一ガイドライン
- プロジェクトごとのカスタマイズ例

**使用タイミング**: 日本語でコミットメッセージを書く時、または日本語規約を導入する時

### `references/best_practices.md`

コミットメッセージのベストプラクティス：
- 7つの黄金律
- アトミックコミットの原則
- 「何を」書くべきか（コンテキスト、ビジネス背景、影響範囲）
- シナリオ別ベストプラクティス（バグ修正、新機能、リファクタリングなど）
- アンチパターン
- チーム規約の策定方法
- ツールでの自動化

**使用タイミング**: 一般的なベストプラクティスを知りたい時、チーム規約を作成する時、コミットメッセージの品質を向上させたい時

### `references/templates.md`

状況別コミットメッセージテンプレート集：
- 基本テンプレート（シンプル、標準、完全版）
- 状況別テンプレート：
  - 新機能追加（小規模・中規模・大規模）
  - バグ修正（シンプル・詳細・緊急修正）
  - リファクタリング
  - パフォーマンス改善
  - ドキュメント更新
  - テスト
  - ビルド・設定
  - 破壊的変更
  - リバート
  - マージ
- Git テンプレート設定方法
- クイックリファレンス

**使用タイミング**: 特定の状況に応じたテンプレートが必要な時、すぐに使えるフォーマットが欲しい時

## 実践例

### 例1: 新機能のコミットメッセージ生成

**状況**: ユーザーがダークモード機能を実装し、コミットメッセージを作成したい

**手順**:
1. git diff --staged で変更を確認
2. 以下の変更を発見：
   - `src/theme/dark-mode.ts` 新規作成
   - `src/components/ThemeToggle.tsx` 新規作成
   - `src/App.tsx` にテーマ切り替え実装
   - `package.json` に依存関係追加

3. Conventional Commits 形式で生成：

```
feat: ダークモード機能を追加

ヘッダーにダークモード切り替えボタンを追加。
ユーザーの設定は localStorage に保存され、
次回訪問時も反映される。

実装内容：
- ThemeProvider でアプリ全体のテーマ管理
- ThemeToggle コンポーネントで切り替え UI
- システム設定の自動検出に対応

Closes #456
```

### 例2: バグ修正のコミットメッセージ検証

**状況**: ユーザーが書いたメッセージをレビューしてほしい

**元のメッセージ**:
```
Fixed bug.
```

**検証結果**:
❌ 問題点：
- 曖昧すぎる（どのバグを修正したのか不明）
- 過去形を使用（"Fixed" ではなく "fix" を推奨）
- type プレフィックスがない

**改善案**:
```
fix: ログイン時のセッションタイムアウトエラー

セッション有効期限の判定ロジックに誤りがあり、
有効なセッションでもタイムアウトエラーが
表示されていた問題を修正。

Fixes #789
```

### 例3: 日本語でのリファクタリングメッセージ

**状況**: 認証ロジックをリファクタリングし、日本語でメッセージを作成

**生成されるメッセージ**:
```
リファクタリング：認証ロジックの整理

【背景】
認証関連のコードが複数ファイルに散在し、
新しい認証方式の追加が困難になっていた。

【変更内容】
1. AuthService クラスに処理を集約
2. JWT処理を TokenManager に分離
3. セッション管理を SessionStore に分離

【保証】
全ての既存テストが通過。
外部から見た動作は完全に同一。

【メリット】
- コードの見通しが大幅に改善
- 新しい認証方式の追加が容易に
- テストが書きやすくなった
```

## ヒントとコツ

### プロジェクトの規約を自動判定

既存のコミット履歴から規約を推測：

```bash
git log --oneline -20
```

- `feat:`, `fix:` などがあれば → Conventional Commits
- `add:`, `update:` などがあれば → Semantic Commits
- 日本語の動詞があれば → 日本語の慣習

### commitlint 設定の確認

プロジェクトに `.commitlintrc.js` や `commitlint.config.js` があれば、
それに従ってメッセージを生成します。

### git log から学ぶ

最近のコミットを見て、プロジェクトのスタイルを把握：

```bash
git log --oneline -10
git log --format="%B" -1  # 最新コミットの詳細
```

### アトミックコミット

1つのコミット = 1つの論理的変更を保つことで：
- レビューしやすい
- revert しやすい
- 履歴が明確

複数の独立した変更がある場合は、複数のコミットに分割することを提案します。

### 本文を省略してよい場合

以下の場合は本文なしで件名のみでも許容：
- 変更が自明（タイポ修正、フォーマットなど）
- 件名だけで十分に説明できる
- 非常に小さな変更

ただし、迷ったら本文を書くことを推奨します。

## まとめ

このスキルを使用することで：

1. **一貫性**: プロジェクト全体で統一された規約
2. **可読性**: 後で見返しても理解しやすい履歴
3. **効率性**: レビューとデバッグの時間短縮
4. **自動化**: リリースノートやCHANGELOGの自動生成が可能

**最終目標**: 6ヶ月後に自分や他の開発者がコミット履歴を見て、すぐに変更の意図を理解できること。

---

**使用方法**: ユーザーが「コミットメッセージを作成して」「コミットを作成」と依頼したら、このスキルを活用してください。規約の詳細が必要な場合は、適切な references ファイルを読み込んで参照してください。
