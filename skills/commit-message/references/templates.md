# コミットメッセージテンプレート集

様々な状況に応じたコミットメッセージのテンプレートを提供します。

## 基本テンプレート

### シンプル（件名のみ）

```
<type>: <簡潔な説明>
```

例：
```
feat: ダークモード機能を追加
fix: ログインエラーを修正
docs: README を更新
```

### 標準（件名 + 本文）

```
<type>: <簡潔な説明>

<詳細な説明>
- 変更内容1
- 変更内容2

<Issue参照>
```

例：
```
feat: ユーザー検索機能

以下の機能を実装：
- 名前での検索
- メールアドレスでの検索
- あいまい検索対応

Closes #123
```

### 完全版（件名 + 本文 + フッター）

```
<type>[optional scope]: <簡潔な説明>

【背景】
<なぜこの変更が必要か>

【変更内容】
<何を変更したか>

【影響範囲】
<どこに影響するか>

【検証】
<どのように確認したか>

<Issue参照・破壊的変更・その他>
```

## 状況別テンプレート

### 1. 新機能追加（Feature）

#### 小規模な機能

```
feat: <機能名>

<機能の概要を1-2文で説明>

Closes #<issue番号>
```

**実例：**
```
feat: パスワード表示切り替えボタン

ログイン画面とパスワード変更画面に、
入力したパスワードを表示/非表示できるボタンを追加。

Closes #234
```

#### 中規模な機能

```
feat: <機能名>

【概要】
<機能の目的と概要>

【実装内容】
- <実装した内容1>
- <実装した内容2>
- <実装した内容3>

【技術的詳細】
<使用した技術や実装方法>

Closes #<issue番号>
```

**実例：**
```
feat: メール通知のカスタマイズ機能

【概要】
ユーザーが受け取るメール通知を
個別に設定できる機能を追加。

【実装内容】
- 通知設定画面の追加
- 通知種別ごとのON/OFF設定
- デフォルトは全ての通知がON

【技術的詳細】
notification_preferences テーブルを新規作成。
メール送信前に設定をチェックする処理を追加。

Closes #456
```

#### 大規模な機能

```
feat(<scope>): <機能名>

【背景】
<機能が必要になった理由・ビジネス的な背景>

【概要】
<機能の全体像>

【実装内容】
<詳細な実装内容をセクションごとに>

【技術スタック】
- <使用した技術1>
- <使用した技術2>

【データベース変更】
<テーブルやカラムの追加/変更>

【API変更】
<新規エンドポイントや変更>

【今後の予定】
<フェーズ2以降で実装予定の機能>

【関連ドキュメント】
<設計書やAPIドキュメントへのリンク>

Closes #<issue番号>
```

**実例：**
```
feat(payment): 複数決済方法の対応

【背景】
クレジットカードのみの決済では、
ユーザーからの要望に応えられず、
コンバージョン率が低下していた。

【概要】
クレジットカード、銀行振込、電子マネーの
3つの決済方法に対応。

【実装内容】
1. 決済方法選択画面の追加
2. 各決済方法の処理実装
   - クレジットカード: Stripe API
   - 銀行振込: 振込先情報表示
   - 電子マネー: PayPay API
3. 決済履歴の管理機能

【技術スタック】
- Stripe SDK v10.2
- PayPay SDK v3.1
- 決済処理にStrategy パターンを適用

【データベース変更】
- payment_methods テーブル追加
- payments テーブルに method カラム追加

【API変更】
新規エンドポイント：
- POST /api/payments/credit-card
- POST /api/payments/bank-transfer
- POST /api/payments/e-wallet

【今後の予定】
- コンビニ決済の対応
- 定期支払いの実装

【関連ドキュメント】
docs/payment-integration.md

Closes #789, #790, #791
```

### 2. バグ修正（Fix）

#### シンプルな修正

```
fix: <バグの内容>

<修正内容を簡潔に>

Fixes #<issue番号>
```

**実例：**
```
fix: ログインボタンの二重クリック防止

ボタンクリック後、レスポンスがあるまで
ボタンを無効化するように修正。

Fixes #345
```

#### 詳細な修正

```
fix: <バグの内容>

【問題】
<どのような問題が発生していたか>

【原因】
<問題の根本原因>

【対策】
<どのように修正したか>

【検証】
<修正の確認方法>

Fixes #<issue番号>
```

**実例：**
```
fix: カートの商品重複問題

【問題】
同じ商品を短時間に複数回追加すると、
カートに重複して登録されていた。

【原因】
商品追加のリクエストが並列実行され、
排他制御が不足していた。

【対策】
1. トランザクション処理を追加
2. 商品IDでのユニーク制約を実装
3. フロントエンドでボタンの多重送信を防止

【検証】
- 手動テスト: 連続クリックで問題なし
- 自動テスト: 並列リクエストのテスト追加

Fixes #567
```

#### 緊急修正（Hotfix）

```
fix(hotfix): <緊急度の高いバグ>

⚠️ 緊急修正

【問題】
<本番環境で発生している問題>

【影響範囲】
<どのユーザー・機能に影響しているか>

【応急処置】
<とりあえずの修正内容>

【恒久対策】
<後日実施する根本的な対策>

Fixes #<issue番号>
```

**実例：**
```
fix(hotfix): 決済処理のタイムアウトエラー

⚠️ 緊急修正

【問題】
本番環境で決済処理が頻繁にタイムアウトし、
注文が完了できない状態。

【影響範囲】
全てのユーザーの決済処理

【応急処置】
タイムアウト時間を30秒から90秒に延長。
これにより即座に問題を回避。

【恒久対策】
決済APIの処理を非同期化し、
Webhookでステータスを更新する仕組みに変更予定。
(Issue #890で対応)

Fixes #889
```

### 3. リファクタリング（Refactor）

```
refactor: <対象範囲>

【背景】
<リファクタリングが必要な理由>

【変更内容】
<具体的な変更内容>

【保証】
<機能が変わっていないことの保証>

【メリット】
<リファクタリングの効果>
```

**実例：**
```
refactor: 認証ロジックの整理

【背景】
認証関連のコードが複数ファイルに散在し、
メンテナンスが困難になっていた。

【変更内容】
1. AuthService クラスを作成し処理を集約
2. JWT処理を TokenManager に分離
3. セッション管理を SessionStore に分離

【保証】
- 全ての既存テストが通過
- 外部APIは変更なし
- 動作は完全に同一

【メリット】
- コードの見通しが向上
- テストが書きやすくなった
- 新しい認証方式の追加が容易に
```

### 4. パフォーマンス改善（Performance）

```
perf: <改善内容>

【問題】
<パフォーマンス上の問題>

【ボトルネック分析】
<特定したボトルネック>

【最適化内容】
<実施した最適化>

【結果】
<改善前後の計測結果>

【計測環境】
<ベンチマーク条件>
```

**実例：**
```
perf: 商品一覧ページの読み込み速度改善

【問題】
商品一覧ページの初期表示に5秒以上かかり、
ユーザーからのクレームが増加。

【ボトルネック分析】
1. データベースクエリが遅い（3.5秒）
2. 画像の読み込みが遅い（1.8秒）
3. JavaScriptバンドルが大きい（800KB）

【最適化内容】
1. SQLクエリの最適化とインデックス追加
2. 画像の遅延読み込みとWebP形式への変換
3. コード分割とTree Shaking

【結果】
- 初期表示時間: 5.2秒 → 0.8秒（85%改善）
- データベースクエリ: 3.5秒 → 0.3秒
- 画像読み込み: 1.8秒 → 0.4秒
- バンドルサイズ: 800KB → 250KB
- 直帰率: 35% → 18%（48%改善）

【計測環境】
- 商品数: 10,000件
- ネットワーク: Regular 4G
- デバイス: iPhone 12
```

### 5. ドキュメント更新（Docs）

```
docs: <ドキュメント名> <変更内容>

<変更理由や追加した情報の概要>
```

**実例：**
```
docs: README にトラブルシューティング追加

よくある問題と解決方法のセクションを追加。
インストールエラーに関するIssueが減少することを期待。
```

```
docs: API ドキュメントに認証方法を追記

OAuth2 の設定手順とサンプルコードを追加。
新規開発者のオンボーディングを改善。
```

### 6. テスト（Test）

```
test: <テスト対象> のテスト<追加/修正>

<テストの内容や目的>
```

**実例：**
```
test: ユーザー登録のE2Eテスト追加

正常系・異常系の両方をカバーする
統合テストを追加。

カバレッジ: 65% → 82%
```

```
test: 決済処理のモックを改善

外部API依存のテストを安定化。
テストの実行時間を50%短縮。
```

### 7. ビルド・設定（Build/Chore）

```
chore: <変更内容>

<変更理由や影響範囲>
```

**実例：**
```
chore: Node.js を v16 から v18 に更新

LTSバージョンへの移行。
セキュリティアップデートを含む。
```

```
build: webpack 設定の最適化

本番ビルドサイズを30%削減。
ビルド時間を2分から45秒に短縮。
```

### 8. スタイル変更（Style）

```
style: <変更内容>

<変更理由>
```

**実例：**
```
style: コードフォーマットを統一

Prettier でコード全体を整形。
コードレビューの効率化を図る。
```

### 9. 破壊的変更（Breaking Changes）

```
<type>!: <変更内容>

BREAKING CHANGE: <破壊的変更の詳細>

【変更理由】
<なぜ破壊的変更が必要か>

【影響範囲】
<どこに影響するか>

【移行方法】
<既存コードの移行手順>

【移行期限】
<旧バージョンのサポート期限>

【サポート】
<移行に関する問い合わせ先>
```

**実例：**
```
feat!: API v2 への移行

BREAKING CHANGE: API v1 は廃止されます。

【変更理由】
RESTful な設計への刷新と、
新機能のサポートのため。

【影響範囲】
- 全ての API エンドポイント
- 認証方式の変更
- レスポンス形式の変更

【移行方法】
1. ベースURL を /api/v1 から /api/v2 に変更
2. 認証ヘッダーを Authorization: Bearer に統一
3. レスポンス形式を確認（ネストが浅くなっています）

詳細な移行ガイド: docs/api-v2-migration.md

【移行期限】
2024年6月30日まで v1 もサポート。
それ以降は v2 のみ。

【サポート】
質問は Slack #api-migration チャンネルへ

Closes #999
```

### 10. リバート（Revert）

```
revert: <元のコミットメッセージ>

This reverts commit <commit hash>.

【理由】
<リバートする理由>

【影響】
<リバートの影響範囲>

【今後の対応】
<再実装の予定など>
```

**実例：**
```
revert: feat: 新しい決済API の導入

This reverts commit a1b2c3d4.

【理由】
本番環境でタイムアウトエラーが頻発し、
決済が完了しない問題が発生。

【影響】
決済APIは旧バージョンに戻ります。

【今後の対応】
タイムアウト問題を修正後、
改めて導入予定（Issue #1001）
```

### 11. マージコミット（Merge）

```
Merge branch '<branch-name>' into <target-branch>

<マージ内容の概要>

【含まれる変更】
- <主な変更1>
- <主な変更2>

【動作確認】
<統合テストの結果など>
```

**実例：**
```
Merge branch 'feature/user-profile' into develop

ユーザープロフィール機能を統合

【含まれる変更】
- プロフィール表示・編集機能
- アバター画像のアップロード
- プライバシー設定

【動作確認】
全ての統合テストがパス。
ステージング環境での確認完了。
```

## 特殊なケース

### 初期コミット

```
chore: 初期コミット

プロジェクトのセットアップ完了。

【構成】
- Next.js 14
- TypeScript
- Tailwind CSS
- PostgreSQL

【環境】
- Node.js v18
- npm v9
```

### 複数Issue対応

```
feat: ユーザー管理機能の強化

以下の機能を実装：

1. ユーザー検索機能（#123）
   - 名前・メール検索
   - あいまい検索対応

2. ユーザー一括編集（#124）
   - CSVインポート
   - バルク更新

3. ユーザー権限管理（#125）
   - ロールベース権限
   - 細かい権限設定

Closes #123, #124, #125
```

### WIP（作業中）- 推奨しない

WIPコミットは推奨しませんが、どうしても必要な場合：

```
WIP: <作業内容>

⚠️ 作業中のコミット - マージ前に修正予定

<現在の状態>
```

**より良い方法**: ブランチ名で状態を表現し、明確なコミットメッセージを使用

```
# ブランチ名で管理
git checkout -b wip/user-authentication

# 明確なコミット
feat: ユーザー認証APIの骨格実装（未完成）
```

## 複数ファイルの変更パターン

### 関連ファイルの同時変更

```
feat: ユーザーモデルにアバター機能追加

【変更ファイル】
- models/User.ts: avatar_url フィールド追加
- api/users.ts: アバター取得・更新API実装
- components/UserAvatar.tsx: アバター表示コンポーネント
- migrations/004_add_avatar.sql: DBマイグレーション

【動作確認】
全ての関連テストが通過。
```

### テスト込みの実装

```
feat: パスワードリセット機能

実装とテストを含む完全な機能追加。

【実装】
- services/PasswordReset.ts
- api/password-reset.ts
- components/PasswordResetForm.tsx

【テスト】
- services/PasswordReset.test.ts
- api/password-reset.test.ts

カバレッジ: 95%
```

## Git テンプレート設定

### グローバル設定

```bash
# テンプレートファイルを作成
touch ~/.gitmessage

# Gitに設定
git config --global commit.template ~/.gitmessage
```

### テンプレートファイル内容

```
# ~/.gitmessage

# <type>: <件名>
#
# <本文>
#
# <フッター>

# Type一覧:
#   feat: 新機能
#   fix: バグ修正
#   docs: ドキュメント
#   style: フォーマット
#   refactor: リファクタリング
#   perf: パフォーマンス
#   test: テスト
#   chore: その他
#
# 件名のルール:
#   - 50文字以内
#   - 命令形
#   - 末尾にピリオド不要
#
# 本文のルール:
#   - 72文字で折り返し
#   - 「何を」「なぜ」を説明
#
# フッター:
#   - Closes #123
#   - Fixes #456
#   - BREAKING CHANGE: 詳細
```

## IDE統合

### VSCode設定

```json
// .vscode/settings.json
{
  "git.inputValidationLength": 50,
  "git.inputValidationSubjectLength": 50,
  "conventionalCommits.scopes": [
    "auth",
    "api",
    "ui",
    "db"
  ]
}
```

### コミットメッセージ検証（commitlint）

```javascript
// commitlint.config.js
module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-enum': [
      2,
      'always',
      [
        'feat', 'fix', 'docs', 'style',
        'refactor', 'perf', 'test', 'chore'
      ]
    ],
    'subject-max-length': [2, 'always', 50],
    'body-max-line-length': [2, 'always', 72]
  }
};
```

## クイックリファレンス

### よく使うパターン

| 状況 | テンプレート |
|------|------------|
| 小さな機能追加 | `feat: <機能名>` |
| バグ修正 | `fix: <バグ内容>` |
| ドキュメント | `docs: <ドキュメント名> <内容>` |
| リファクタリング | `refactor: <対象>` |
| パフォーマンス | `perf: <改善内容>` |
| テスト追加 | `test: <テスト対象> のテスト追加` |
| 依存関係更新 | `chore: <パッケージ名> を更新` |
| 設定変更 | `chore: <設定内容>` |
| スタイル変更 | `style: <変更内容>` |

### チートシート

```
# 新機能
feat: ○○機能を追加

# バグ修正
fix: ○○のエラーを修正

# ドキュメント
docs: README を更新

# スタイル
style: コードフォーマットを統一

# リファクタリング
refactor: ○○を整理

# パフォーマンス
perf: ○○を最適化

# テスト
test: ○○のテスト追加

# ビルド
build: ○○の設定変更

# CI
ci: GitHub Actions を更新

# その他
chore: ○○を更新
```

このテンプレート集を参考に、プロジェクトに適したコミットメッセージを作成してください。
