# 日本語コミットメッセージの慣習

日本語でコミットメッセージを書く際のベストプラクティスとガイドラインです。

## 基本方針

日本語のコミットメッセージは、チーム内のコミュニケーションを円滑にし、変更履歴を理解しやすくします。

### メリット

- **母国語での記述**: 細かいニュアンスを正確に伝えられる
- **チーム内理解**: 日本語ネイティブチームでの可読性向上
- **詳細な説明**: 複雑な変更内容も分かりやすく説明できる
- **迅速な記述**: 英語に翻訳する時間を削減

### デメリットと対策

- **国際化**: グローバルチームには不向き → 英語と併用を検討
- **ツール対応**: 一部ツールが非ASCII文字に非対応 → UTF-8を使用
- **文字化け**: 環境によって文字化けの可能性 → UTF-8エンコーディングを統一

## 基本フォーマット

### パターン1: 動詞始まり（簡潔型）

```
<動詞>：<対象>

[詳細説明]

[フッター]
```

例：
```
追加：ユーザー認証機能
修正：ログイン画面のレイアウト崩れ
更新：README にインストール手順を記載
削除：使用していないライブラリ
```

### パターン2: 名詞句（説明型）

```
<変更内容の説明>

[詳細説明]

[フッター]
```

例：
```
ユーザー認証機能の実装
ログイン画面のレイアウト修正
READMEの更新（インストール手順の追加）
未使用ライブラリの削除
```

### パターン3: ハイブリッド（プレフィックス + 日本語）

```
<英語プレフィックス>: <日本語説明>

[詳細説明]

[フッター]
```

例：
```
feat: ユーザー認証機能の追加
fix: ログイン画面のレイアウト崩れを修正
docs: README にインストール手順を追加
chore: 未使用ライブラリの削除
```

## 推奨される動詞

### 主要な動詞（敬体なし、体言止め）

| 動詞 | 用途 | 例 |
|------|------|-----|
| 追加 | 新機能、ファイル追加 | 追加：ダークモード機能 |
| 実装 | 機能の実装 | 実装：メール送信機能 |
| 作成 | 新規作成 | 作成：ユーザー管理画面 |
| 更新 | 既存の改善・変更 | 更新：ログイン処理のフロー |
| 修正 | バグ修正 | 修正：null参照エラー |
| 削除 | 削除・除去 | 削除：廃止予定のAPI |
| 変更 | 一般的な変更 | 変更：設定ファイルの構造 |
| 改善 | 品質・性能向上 | 改善：検索速度の最適化 |
| リファクタリング | コード整理 | リファクタリング：認証ロジック |
| 整理 | コードの整頓 | 整理：importステートメント |

### 補助的な動詞

| 動詞 | 用途 | 例 |
|------|------|-----|
| 対応 | 問題への対処 | 対応：iOS 17の新API |
| 調整 | 微調整 | 調整：余白とフォントサイズ |
| 統合 | マージ・統合 | 統合：決済モジュール |
| 分離 | 分割・分離 | 分離：ビジネスロジックとUI |
| 移動 | 場所の変更 | 移動：utilsフォルダへ |
| 名前変更 | リネーム | 名前変更：getUser → fetchUser |
| アップグレード | バージョンアップ | アップグレード：React 18 |
| ダウングレード | バージョンダウン | ダウングレード：Node 16 |

## 実例集

### 新機能追加

```
追加：パスワードリセット機能

メールによるパスワードリセットフローを実装。
- トークンの有効期限は24時間
- メールテンプレートはカスタマイズ可能
- セキュリティログに記録

関連Issue: #234
```

### バグ修正

```
修正：商品一覧ページの無限スクロール

スクロール時に同じデータが重複して
表示される不具合を修正。

原因：ページネーション処理のオフセット計算ミス
対策：offset値を正しく計算するように修正

Fixes #456
```

### リファクタリング

```
リファクタリング：認証関連のコード整理

認証ロジックを複数のモジュールに分離：
- AuthService: 認証処理の中核
- TokenManager: トークン管理
- SessionStore: セッション状態管理

機能の変更はなし。テストは全てパス。
```

### パフォーマンス改善

```
改善：画像読み込みのパフォーマンス最適化

レイジーローディングとWebP形式の導入により、
初期ロード時間を40%短縮。

変更内容：
- Intersection Observer APIで遅延読み込み
- 画像をWebP形式に変換（フォールバックあり）
- 適切なサイズの画像を配信（レスポンシブ対応）
```

### ドキュメント更新

```
更新：API ドキュメントに認証方法を追記

READMEとAPI.mdに以下を追加：
- OAuth2の設定手順
- トークン取得の具体例
- エラーコード一覧
```

### 設定変更

```
変更：TypeScript の strict モードを有効化

より安全なコード品質のため、strictオプションを有効化。
型エラーは全て修正済み。

影響範囲：全TypeScriptファイル
```

### 依存関係更新

```
アップグレード：Next.js を 13.4 から 14.0 に更新

主な変更点：
- App Router の安定版を使用
- Server Actionsの正式サポート
- 画像最適化の改善

破壊的変更への対応完了。
```

## 件名（1行目）の書き方

### 基本ルール

1. **簡潔に**: 50文字以内を目安
2. **具体的に**: 何をしたか明確に
3. **体言止め**: 「～する」より「～の追加」
4. **句点不要**: 文末に句点（。）は付けない

### 良い例と悪い例

❌ **悪い例：**
```
バグを直しました。
いくつかの修正
コードの変更
```

✅ **良い例：**
```
修正：ユーザー登録時のバリデーションエラー
更新：検索機能のUI改善
リファクタリング：日付処理ユーティリティ
```

### 具体性のレベル

**❌ 不十分：**
```
修正：エラー対応
更新：画面修正
```

**△ 許容範囲：**
```
修正：ログインエラー
更新：ユーザー画面
```

**✅ 理想的：**
```
修正：ログイン時のセッションタイムアウトエラー
更新：ユーザープロフィール画面のレイアウト
```

## 本文の書き方

### 「何を」「なぜ」を明確に

```
追加：データエクスポート機能

【背景】
ユーザーから自分のデータをCSV形式で
ダウンロードしたいという要望が多数あった。

【実装内容】
- CSV形式でのエクスポート機能を追加
- 最大10万件までのデータに対応
- バックグラウンド処理で非同期実行

【今後の予定】
- JSON形式のサポート
- フィルタ機能の追加
```

### 箇条書きの活用

```
修正：決済処理の安定性向上

以下の問題に対処：
- タイムアウト時のリトライ処理追加
- トランザクションの排他制御強化
- エラーログの詳細化

テスト内容：
- 正常系：100回実行で全て成功
- 異常系：ネットワークエラー時の挙動確認
- 負荷テスト：秒間100リクエストで安定動作
```

### 技術的詳細

```
改善：データベースクエリの最適化

【問題】
ユーザー一覧取得に平均3秒かかっていた。

【原因分析】
- JOINが多重になっていた
- インデックスが適切に設定されていなかった
- N+1問題が発生していた

【対策】
1. 必要最小限のJOINに削減
2. 検索条件カラムにインデックス追加
3. eager loadingで関連データを一括取得

【結果】
平均応答時間が300msに短縮（90%改善）
```

## フッターの活用

### Issue参照

```
修正：画像アップロードの失敗

Fixes #123
Closes #456
関連Issue: #789
```

### Co-authored-by（共同作業）

```
実装：リアルタイム通知機能

WebSocketを使用したリアルタイム通知を実装。

Co-authored-by: 山田太郎 <yamada@example.com>
Co-authored-by: 佐藤花子 <sato@example.com>
```

### 破壊的変更

```
変更：認証APIのレスポンス形式

⚠️ 破壊的変更

以前のレスポンス形式：
{ "token": "xxx", "user": {...} }

新しいレスポンス形式：
{ "access_token": "xxx", "refresh_token": "yyy", "user": {...} }

移行ガイド：docs/migration-v2.md
```

## スタイルガイドライン

### 文体の統一

**常体（である調）を推奨：**
```
✅ 追加：ログイン機能を実装
✅ 修正：エラーハンドリングを改善
```

**敬体（ですます調）は避ける：**
```
❌ 追加：ログイン機能を実装しました
❌ 修正：エラーハンドリングを改善しました
```

### 記号の使用

**全角と半角：**
- 句読点：全角（、。）または半角（,）で統一
- カッコ：全角（）を推奨
- コロン：全角：または半角:で統一

```
推奨：
追加：ユーザー認証機能（JWT方式）

許容：
追加: ユーザー認証機能(JWT方式)
```

### 英単語の扱い

**技術用語は英語のまま：**
```
✅ 修正：WebSocket接続エラー
✅ 追加：RESTful API エンドポイント
✅ 更新：Redisのキャッシュ戦略

❌ 修正：ウェブソケット接続エラー
❌ 追加：レストフルAPIエンドポイント
```

### 改行とインデント

```
追加：複数の新機能

以下の機能を実装：

1. ユーザー検索
   - 名前・メールアドレスでの検索
   - あいまい検索対応

2. フィルタ機能
   - 登録日時での絞り込み
   - ステータスでの絞り込み

3. ソート機能
   - 名前順・登録日時順に対応
```

## プロジェクトごとのカスタマイズ

### プレフィックスの定義

プロジェクトで使用するプレフィックスを定義：

```
# プロジェクトのコミットメッセージ規約

## プレフィックス一覧
- 機能: 新機能の追加
- 修正: バグ修正
- 改善: 既存機能の改善
- 文書: ドキュメント更新
- 設定: 設定ファイルの変更
- 試験: テストコード
- 整形: コードフォーマット
- 依存: 依存パッケージの更新
```

### スコープの活用

```
機能(認証): パスワードリセット機能
修正(UI): ボタンの配置
改善(API): レスポンス速度の向上
```

## ツールとの統合

### commitlint設定例

```javascript
// commitlint.config.js
module.exports = {
  rules: {
    'type-enum': [
      2,
      'always',
      ['追加', '修正', '更新', '削除', '改善', 'リファクタリング']
    ],
    'subject-empty': [2, 'never'],
    'subject-max-length': [2, 'always', 50]
  }
};
```

## まとめ

### チェックリスト

コミット前に確認：

- [ ] 件名は50文字以内で具体的か
- [ ] 何を変更したか明確か
- [ ] なぜ変更したか説明されているか
- [ ] 文体が統一されているか
- [ ] 技術用語が正しく使用されているか
- [ ] Issue番号が必要な場合、記載されているか

### 推奨プラクティス

1. **アトミックコミット**: 1つの論理的変更ごとにコミット
2. **頻繁なコミット**: 小さな単位でこまめにコミット
3. **意味のある履歴**: レビューしやすい粒度を保つ
4. **チームで統一**: プロジェクト内でルールを決めて遵守
5. **定期的な見直し**: コミットメッセージの品質を定期的にレビュー
